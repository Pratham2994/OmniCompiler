@import "tailwindcss";
@import "reactflow/dist/style.css";

/* Omni Compiler — Design Tokens (Light/Dark) */
:root {
  --oc-bg: #f6f6f8;
  --oc-fg: #0b0d12;
  --oc-surface: #ffffff;
  --oc-surface-2: #f3f4f6;
  --oc-border: rgba(17,17,17,0.08);

  --oc-primary-500: #8b5cf6; /* light purple */
  --oc-primary-600: #7c3aed; /* vibrant purple */
  --oc-primary-700: #6d28d9; /* dark purple */

  --oc-muted: #6b7280;
  --oc-ring: var(--oc-primary-500);
  --oc-on-primary: #ffffff; /* readable foreground on primary in light */

  --oc-success: #22c55e;
  --oc-danger: #ef4444;

  /* Console line colors (Light) */
  --oc-console-log: #64748b; /* slate-500 (duller logs) */
  --oc-console-out: #16a34a; /* green-600 (stdout) */
  --oc-console-err: #dc2626; /* red-600 (stderr) */
  --oc-console-in:  #0891b2; /* cyan-700 (stdin echo) */

  /* Execution trace semantic colors (Light) */
  --oc-trace-function: #8b5cf6;
  --oc-trace-class: #eab308;
  --oc-trace-conditional: #f97316;
  --oc-trace-loop: #0ea5e9;
  --oc-trace-return: #10b981;
  --oc-trace-statement: #475569;
  --oc-trace-entry: #22c55e;
  --oc-trace-exit: #ef4444;
  --oc-trace-branch-true: #16a34a;
  --oc-trace-branch-false: #dc2626;
  --oc-trace-exception: #f43f5e;
  --oc-trace-import: #0ea5e9;
  --oc-trace-default: #8b5cf6;
}

/* Dark (VS Code Dark+) — also applies when Run page sets theme-dark */
.dark, .theme-dark {
  --oc-bg: #0b0d12;
  --oc-fg: #e5e7eb;
  --oc-surface: #0f121a;
  --oc-surface-2: #10141d;
  --oc-border: rgba(255,255,255,0.10);

  --oc-primary-500: #a78bfa;
  --oc-primary-600: #8b5cf6;
  --oc-primary-700: #7c3aed;

  --oc-muted: #9ca3af;
  --oc-ring: var(--oc-primary-600);
  --oc-on-primary: #ffffff; /* readable foreground on purple in dark */

  /* Console line colors (Dark) */
  --oc-console-log: #9ca3af; /* gray-400 (duller logs) */
  --oc-console-out: #86efac; /* emerald-300 (stdout) */
  --oc-console-err: #f87171; /* red-400 (stderr) */
  --oc-console-in:  #7dd3fc; /* sky-300 (stdin echo) */

  /* Execution trace semantic colors (Dark) */
  --oc-trace-function: #c4b5fd;
  --oc-trace-class: #facc15;
  --oc-trace-conditional: #fb923c;
  --oc-trace-loop: #38bdf8;
  --oc-trace-return: #34d399;
  --oc-trace-statement: #94a3b8;
  --oc-trace-entry: #4ade80;
  --oc-trace-exit: #f87171;
  --oc-trace-branch-true: #4ade80;
  --oc-trace-branch-false: #f87171;
  --oc-trace-exception: #fb7185;
  --oc-trace-import: #67e8f9;
  --oc-trace-default: #a78bfa;
}

/* Light (VS Code Light+) — uses :root defaults; class present for clarity */
.theme-light {
  /* Intentionally empty: falls back to :root tokens */
}

/* High Contrast (VS Code High Contrast) */
.theme-hc {
  --oc-bg: #000000;
  --oc-fg: #ffffff;
  --oc-surface: #0b0b0b;
  --oc-surface-2: #141414;
  --oc-border: rgba(255,255,255,0.35);

  /* Accent with strong yellow similar to HC emphasis */
  --oc-primary-500: #f5d90a;
  --oc-primary-600: #f0c000;
  --oc-primary-700: #e0a800;

  --oc-muted: #e5e7eb;
  --oc-ring: var(--oc-primary-600);
  --oc-on-primary: #000000; /* black text on yellow for true HC */

  /* Console line colors (High Contrast) */
  --oc-console-log: #bfbfbf; /* lighter gray for logs */
  --oc-console-out: #f5d90a; /* yellow (stdout) */
  --oc-console-err: #ff4d4d; /* vivid red (stderr) */
  --oc-console-in:  #00d0ff; /* bright cyan (stdin echo) */

  /* Execution trace semantic colors (HC) */
  --oc-trace-function: #f5d90a;
  --oc-trace-class: #00f0ff;
  --oc-trace-conditional: #ffa500;
  --oc-trace-loop: #00d0ff;
  --oc-trace-return: #00ff85;
  --oc-trace-statement: #ffffff;
  --oc-trace-entry: #00ff5f;
  --oc-trace-exit: #ff4d4d;
  --oc-trace-branch-true: #00ff5f;
  --oc-trace-branch-false: #ff4d4d;
  --oc-trace-exception: #ff66ff;
  --oc-trace-import: #00a3ff;
  --oc-trace-default: #f5d90a;
}

/* App background/text */
html, body, #root {
  background-color: var(--oc-bg);
  color: var(--oc-fg);
}

/* Cards / Panels */
.oc-card {
  background: var(--oc-surface);
  border: 1px solid var(--oc-border);
  border-radius: 0.5rem;
  box-shadow: 0 1px 2px rgba(0,0,0,0.02);
}

/* Buttons */
.oc-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  height: 2.25rem;
  padding: 0 0.75rem;
  border-radius: 0.5rem;
  font-size: 0.875rem;
  font-weight: 500;
  border: 1px solid var(--oc-border);
  background: var(--oc-surface);
  color: var(--oc-fg);
  transition: background-color 150ms ease, color 150ms ease, border-color 150ms ease, box-shadow 150ms ease, transform 50ms ease;
}
.oc-btn:hover { background: var(--oc-surface-2); }
.oc-btn:active { transform: translateY(0.5px); }
.oc-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--oc-ring); }

.oc-btn-primary {
  border: 1px solid transparent;
  background-image: linear-gradient(135deg, var(--oc-primary-600), var(--oc-primary-700));
  color: var(--oc-on-primary);
  box-shadow: 0 1px 2px rgba(124,58,237,0.25);
}
.oc-btn-primary:hover { filter: brightness(1.05); }
.oc-btn-primary:active { transform: translateY(0.5px); }
.oc-btn-primary:disabled { opacity: 0.7; cursor: not-allowed; }

.oc-icon-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 2.125rem;
  width: 2.125rem;
  border-radius: 0.5rem;
  border: 1px solid var(--oc-border);
  background: var(--oc-surface);
  color: var(--oc-fg);
  transition: background-color 150ms ease, color 150ms ease, border-color 150ms ease, box-shadow 150ms ease, transform 50ms ease;
}
.oc-icon-btn:hover { background: var(--oc-surface-2); }
.oc-icon-btn:active { transform: translateY(0.5px); }
.oc-icon-btn:focus-visible { outline: none; box-shadow: 0 0 0 2px var(--oc-ring); }

/* Inputs */
.oc-input {
  height: 2.5rem;
  width: 100%;
  border-radius: 0.5rem;
  border: 1px solid var(--oc-border);
  background: var(--oc-surface-2);
  color: var(--oc-fg);
  padding: 0 0.75rem;
  font-size: 0.875rem;
  transition: border-color 150ms ease, box-shadow 150ms ease, background-color 150ms ease;
}
.oc-input::placeholder { color: var(--oc-muted); }
.oc-input:focus { outline: none; border-color: var(--oc-primary-600); box-shadow: 0 0 0 2px var(--oc-ring); }

/* Chips / badges */
.oc-chip {
  display: inline-flex;
  align-items: center;
  height: 2rem;
  padding: 0 0.5rem;
  font-size: 0.75rem;
  border-radius: 0.375rem;
  background: var(--oc-surface-2);
  border: 1px solid var(--oc-border);
  color: var(--oc-fg);
}

/* CFG view */
.oc-cfg-item { position: relative; list-style: none; }
.oc-cfg-row { display: flex; align-items: center; gap: 0.4rem; }
.oc-cfg-toggle {
  height: 1.75rem;
  width: 1.75rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  border-radius: 0.5rem;
  border: 1px solid var(--oc-border);
  background: var(--oc-surface-2);
  color: var(--oc-fg);
  transition: background-color 150ms ease, transform 120ms ease, box-shadow 150ms ease;
}
.oc-cfg-toggle:hover { background: var(--oc-surface); }
.oc-cfg-toggle:active { transform: translateY(0.5px); }
.oc-cfg-dot {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1rem;
  height: 1rem;
  border-radius: 999px;
  box-shadow: 0 0 0 2px var(--oc-surface), 0 0 0 3px var(--oc-border);
}
.oc-cfg-arrow {
  flex: 0 0 1.6rem;
  height: 2px;
  background: var(--oc-border);
  border-radius: 999px;
  position: relative;
  margin-top: 0.4rem;
}
.oc-cfg-arrow::after {
  content: '';
  position: absolute;
  right: -4px;
  top: -3px;
  width: 0;
  height: 0;
  border-top: 5px solid transparent;
  border-bottom: 5px solid transparent;
  border-left: 6px solid var(--oc-border);
}
.oc-cfg-node {
  display: block;
  width: 100%;
  text-align: left;
  border: 1px solid var(--oc-border);
  background: linear-gradient(135deg, var(--oc-surface), var(--oc-surface-2));
  color: var(--oc-fg);
  border-radius: 999px;
  padding: 0.65rem 0.9rem;
  transition: transform 140ms ease, box-shadow 160ms ease, border-color 140ms ease, background-color 160ms ease;
}
.oc-cfg-node:hover { transform: translateY(-1px); }
.oc-cfg-node:active { transform: translateY(0); }
.oc-cfg-node-top { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
.oc-cfg-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.25rem;
  padding: 0.2rem 0.5rem;
  font-size: 0.65rem;
  border-radius: 999px;
  border: 1px solid transparent;
  letter-spacing: 0.04em;
  text-transform: uppercase;
}
.oc-cfg-title { font-weight: 700; font-size: 0.95rem; min-width: 0; flex: 1 1 auto; }
.oc-cfg-lines { font-size: 0.75rem; color: var(--oc-muted); white-space: nowrap; }
.oc-cfg-meta { margin-top: 2px; font-size: 0.68rem; color: var(--oc-muted); }
.oc-cfg-branch {
  border-left: 2px dashed var(--oc-border);
  margin-left: 1.5rem;
  padding-left: 1rem;
  position: relative;
}
.oc-cfg-branch::before {
  content: '';
  position: absolute;
  top: 10px;
  left: -2px;
  width: 10px;
  height: 2px;
  background: var(--oc-border);
  border-radius: 999px;
}
.oc-cfg-graph-wrapper {
  border: 1px solid var(--oc-border);
  border-radius: 0.75rem;
  background: var(--oc-surface);
  box-shadow: 0 4px 18px rgba(0,0,0,0.08);
}
.oc-cfg-graph-shell {
  max-height: 620px;
  overflow: auto;
  padding: 0.5rem;
}
.oc-cfg-graph {
  display: block;
  background: radial-gradient(circle at 20% 20%, rgba(124,58,237,0.06), transparent 35%), radial-gradient(circle at 80% 30%, rgba(34,211,238,0.08), transparent 38%), var(--oc-surface-2);
  border-radius: 0.75rem;
  border: 1px solid var(--oc-border);
}
.oc-cfg-graph-card {
  width: 180px;
  height: 56px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  padding: 0.35rem 0.65rem;
  gap: 0.15rem;
  cursor: pointer;
}
.oc-cfg-graph-card:hover { background: rgba(255,255,255,0.06); }

.oc-cfg-flow-shell {
  border-radius: 0.75rem;
  border: 1px solid var(--oc-border);
  background: radial-gradient(circle at 15% 20%, rgba(124,58,237,0.08), transparent 35%), radial-gradient(circle at 70% 10%, rgba(34,211,238,0.09), transparent 40%), var(--oc-surface);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.04), 0 12px 30px rgba(0,0,0,0.18);
  overflow: hidden;
}
.oc-cfg-flow-shell .react-flow__renderer { font-family: inherit; }
.oc-cfg-flow-shell .react-flow__node-default {
  background: transparent;
  box-shadow: none;
  border: none;
  color: var(--oc-fg);
}
.oc-cfg-flow-shell .react-flow__edge-path {
  filter: drop-shadow(0 2px 6px rgba(0,0,0,0.25));
}
.oc-cfg-flow-shell .react-flow__controls {
  background: var(--oc-surface);
  border: 1px solid var(--oc-border);
  border-radius: 0.5rem;
  overflow: hidden;
}
.oc-cfg-flow-shell .react-flow__controls button {
  background: transparent;
  color: var(--oc-fg);
  border-bottom: 1px solid var(--oc-border);
}
.oc-cfg-flow-shell .react-flow__controls button:last-child { border-bottom: none; }

/* Dividers / borders */
.oc-divider { border-color: var(--oc-border); }

/* Output console colors */
.oc-console {
  background: #0a0a0a;
  color: var(--oc-console-out); /* default text color = stdout */
  border-radius: 0.5rem;
  border: 1px solid rgba(255,255,255,0.08);
}

/* Toast */
.oc-toast {
  border-radius: 0.5rem;
  background: var(--oc-fg);
  color: var(--oc-bg);
  box-shadow: 0 8px 30px rgba(0,0,0,0.25);
}

/* 1) Ensure no width transition animations on the code/output panes (safety net) */
#oc-workspace section[style] { transition: none !important; }

/* Monaco Find widget — minimal, sane alignment and spacing (cleaned up) */
.monaco-editor .find-widget { transition: none !important; }
.monaco-editor .find-widget .monaco-findInput { margin-right: 8px !important; }
.monaco-editor .find-widget .monaco-findInput .controls,
.monaco-editor .find-widget .find-actions {
  display: flex !important;
  align-items: center !important;
  gap: 4px;
}
.monaco-editor .find-widget .codicon {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  vertical-align: middle !important;
}
.monaco-editor .find-widget .codicon.codicon-close {
  position: relative !important;
  top: 0 !important;
  margin: 0 !important;
  transform: none !important;
}
.monaco-editor .find-widget .matchesCount {
  margin: 0 8px !important;
  padding: 0 !important;
}
.monaco-editor .find-widget,
.monaco-editor .find-widget .matchesCount,
.monaco-editor .find-widget .monaco-inputbox .input {
  line-height: normal !important;
}
.monaco-editor .find-widget .message {
  margin: 0 8px !important;
  padding: 0 !important;
}
/* CTA (Run) button — solid, consistent purple; subtle hover/press */
.oc-btn-cta {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.25rem;
  border: 1px solid transparent;
  background: var(--oc-primary-600);
  color: var(--oc-on-primary);
  border-radius: 9999px; /* allow rounded-full buttons */
  box-shadow:
    0 4px 14px rgba(124,58,237,0.25),
    inset 0 -1px 0 rgba(0,0,0,0.15);
  transition: background-color 150ms ease, box-shadow 150ms ease, transform 50ms ease, filter 150ms ease;
}
.oc-btn-cta:hover { background: var(--oc-primary-700); filter: brightness(1.02); }
.oc-btn-cta:active { transform: translateY(0.5px); box-shadow: 0 2px 10px rgba(124,58,237,0.22), inset 0 0 0 rgba(0,0,0,0.15); }
.oc-btn-cta:disabled { opacity: 0.7; cursor: not-allowed; }

/* Theming helpers */
.oc-focus:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px var(--oc-ring);
}

/* Vertical splitter hover color respects theme primary */
.oc-splitter:hover {
  /* Use color-mix to produce a translucent hover color from primary */
  background: color-mix(in srgb, var(--oc-primary-600) 28%, transparent);
}

/* Selected listrow/pill using theme primary tint (works for all themes incl HC) */
.oc-selected {
  background: color-mix(in srgb, var(--oc-primary-600) 16%, transparent);
  outline: 1px solid color-mix(in srgb, var(--oc-primary-600) 55%, transparent);
  outline-offset: 0;
}

/* Per-line console coloring */
.oc-line-log { color: var(--oc-console-log); }
.oc-line-out { color: var(--oc-console-out); }
.oc-line-err { color: var(--oc-console-err); }
.oc-line-in  { color: var(--oc-console-in); }

/* ─────────────────────────────────────────────────────────────────────────────
   Flow Graph - Hierarchical Decision Tree UI
   ───────────────────────────────────────────────────────────────────────────── */

/* Container for each file's flow graph */
.oc-flow-graph-container {
  border: 1px solid var(--oc-border);
  border-radius: 12px;
  background: linear-gradient(135deg, var(--oc-surface), var(--oc-surface-2));
  box-shadow:
    0 4px 20px rgba(0, 0, 0, 0.12),
    inset 0 1px 0 rgba(255, 255, 255, 0.05);
  overflow: hidden;
}

/* File header */
.oc-flow-graph-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--oc-surface);
  border-bottom: 1px solid var(--oc-border);
}

.oc-flow-graph-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 6px;
  background: var(--oc-primary-600);
  color: var(--oc-on-primary);
}

.oc-flow-graph-badge {
  display: inline-flex;
  align-items: center;
  padding: 4px 10px;
  font-size: 11px;
  font-weight: 500;
  border-radius: 20px;
  background: var(--oc-surface-2);
  border: 1px solid var(--oc-border);
  color: var(--oc-muted);
}

/* Flow graph shell */
.oc-flow-graph-shell {
  border-radius: 0 0 12px 12px;
  background:
    radial-gradient(circle at 10% 20%, rgba(124, 58, 237, 0.06), transparent 40%),
    radial-gradient(circle at 90% 80%, rgba(34, 211, 238, 0.06), transparent 40%),
    radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.04), transparent 60%),
    var(--oc-surface);
  overflow: hidden;
}

/* Custom Flow Node Styles */
.oc-flow-node {
  position: relative;
  width: 180px;
  min-height: 70px;
  background: var(--node-bg, rgba(139, 92, 246, 0.1));
  border: 2px solid var(--node-border, rgba(139, 92, 246, 0.4));
  border-radius: 16px;
  padding: 10px 12px;
  cursor: pointer;
  transition:
    transform 0.2s ease,
    box-shadow 0.2s ease,
    border-color 0.2s ease;
  box-shadow:
    0 4px 12px rgba(0, 0, 0, 0.15),
    0 0 0 0 var(--node-color, var(--oc-primary-500));
}

.oc-flow-node:hover {
  transform: translateY(-2px);
  box-shadow:
    0 8px 24px rgba(0, 0, 0, 0.2),
    0 0 0 2px var(--node-color, var(--oc-primary-500));
  border-color: var(--node-color, var(--oc-primary-500));
}

.oc-flow-node-selected {
  box-shadow:
    0 8px 24px rgba(0, 0, 0, 0.25),
    0 0 0 3px var(--node-color, var(--oc-primary-500));
  border-color: var(--node-color, var(--oc-primary-500));
}

/* Decision node (diamond shape effect) */
.oc-flow-node-decision {
  border-radius: 4px;
  transform: rotate(0deg);
}

.oc-flow-node-decision::before {
  content: '';
  position: absolute;
  top: -1px;
  left: 50%;
  transform: translateX(-50%) rotate(45deg);
  width: 8px;
  height: 8px;
  background: var(--node-color, #f97316);
  border: 2px solid var(--node-border, rgba(249, 115, 22, 0.4));
  border-right: none;
  border-bottom: none;
}

/* Loop node indicator */
.oc-flow-node-loop {
  border-style: dashed;
}

/* Inner content */
.oc-flow-node-inner {
  display: flex;
  align-items: flex-start;
  gap: 10px;
}

/* Icon badge */
.oc-flow-node-badge {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border-radius: 8px;
  color: white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

/* Content area */
.oc-flow-node-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.oc-flow-node-type {
  font-size: 9px;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--node-color, var(--oc-primary-500));
  opacity: 0.9;
}

.oc-flow-node-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--oc-fg);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 110px;
}

.oc-flow-node-lines {
  font-size: 10px;
  color: var(--oc-muted);
  font-family: ui-monospace, monospace;
}

/* Branch indicators for decision nodes */
.oc-flow-node-branches {
  position: absolute;
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 24px;
}

.oc-flow-branch {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  font-size: 8px;
  font-weight: 700;
}

.oc-flow-branch-true {
  background: #22c55e;
  color: white;
}

.oc-flow-branch-false {
  background: #ef4444;
  color: white;
}

/* Loop indicator */
.oc-flow-node-loop-indicator {
  position: absolute;
  top: -8px;
  right: 8px;
  background: var(--oc-surface);
  border-radius: 4px;
  padding: 2px;
}

/* Flow handles */
.oc-flow-handle {
  width: 10px !important;
  height: 10px !important;
  border-radius: 50% !important;
  background: var(--oc-surface) !important;
  border: 2px solid var(--node-color, var(--oc-primary-500)) !important;
  transition: transform 0.15s ease, background 0.15s ease;
}

.oc-flow-handle:hover {
  transform: scale(1.3);
  background: var(--node-color, var(--oc-primary-500)) !important;
}

.oc-flow-handle-target {
  top: -5px !important;
}

.oc-flow-handle-source {
  bottom: -5px !important;
}

/* ReactFlow overrides for custom nodes */
.oc-flow-graph-shell .react-flow__node {
  padding: 0;
  border-radius: 0;
  border: none;
  background: transparent;
  box-shadow: none;
}

.oc-flow-graph-shell .react-flow__node-flowNode {
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
}

.oc-flow-graph-shell .react-flow__edge-path {
  stroke-width: 2;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
}

.oc-flow-graph-shell .react-flow__edge.animated .react-flow__edge-path {
  stroke-dasharray: 8;
  animation: oc-flow-dash 0.8s linear infinite;
}

@keyframes oc-flow-dash {
  to {
    stroke-dashoffset: -16;
  }
}

/* Controls styling */
.oc-flow-controls {
  background: var(--oc-surface) !important;
  border: 1px solid var(--oc-border) !important;
  border-radius: 8px !important;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
  overflow: hidden;
}

.oc-flow-controls button {
  background: transparent !important;
  color: var(--oc-fg) !important;
  border: none !important;
  border-bottom: 1px solid var(--oc-border) !important;
  width: 28px !important;
  height: 28px !important;
}

.oc-flow-controls button:last-child {
  border-bottom: none !important;
}

.oc-flow-controls button:hover {
  background: var(--oc-surface-2) !important;
}

/* Edge labels */
.oc-flow-graph-shell .react-flow__edge-text {
  font-size: 10px;
  font-weight: 600;
}

.oc-flow-graph-shell .react-flow__edge-textbg {
  fill: var(--oc-surface);
  fill-opacity: 0.95;
}

/* Minimap (if enabled) */
.oc-flow-graph-shell .react-flow__minimap {
  background: var(--oc-surface) !important;
  border: 1px solid var(--oc-border) !important;
  border-radius: 8px !important;
}

/* Attribution hidden */
.oc-flow-graph-shell .react-flow__attribution {
  display: none !important;
}

/* Background pattern */
.oc-flow-graph-shell .react-flow__background {
  opacity: 0.5;
}

/* ─────────────────────────────────────────────────────────────────────────────
   Execution Trace - Vertical Line-by-Line Flow Visualization
   ───────────────────────────────────────────────────────────────────────────── */

/* Empty state */
.oc-exec-empty {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 200px;
  color: var(--oc-muted);
  text-align: center;
}

/* Main trace container */
.oc-exec-trace {
  display: flex;
  flex-direction: column;
  height: 100%;
}

/* Trace header */
.oc-exec-trace-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  background: var(--oc-surface);
  border-radius: 8px;
  margin-bottom: 12px;
  border: 1px solid var(--oc-border);
  color: var(--oc-fg);
}

.oc-exec-trace-count {
  font-size: 11px;
  font-weight: 500;
  color: var(--oc-muted);
  padding: 4px 10px;
  background: var(--oc-surface-2);
  border-radius: 20px;
  border: 1px solid var(--oc-border);
}

/* Steps container */
.oc-exec-trace-steps {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 0;
  position: relative;
  padding-left: 8px;
}

/* Individual execution step */
.oc-exec-step {
  position: relative;
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 10px 12px;
  margin-left: var(--step-indent, 0);
  background: var(--oc-surface);
  border: 1px solid var(--oc-border);
  border-radius: 10px;
  cursor: pointer;
  transition:
    background-color 0.15s ease,
    border-color 0.15s ease,
    box-shadow 0.15s ease,
    transform 0.15s ease;
  margin-bottom: 4px;
}

.oc-exec-step:hover {
  background: var(--oc-surface-2);
  border-color: color-mix(in srgb, var(--step-color, var(--oc-primary-500)) 40%, var(--oc-border));
  transform: translateX(2px);
}

.oc-exec-step-active {
  background: color-mix(in srgb, var(--step-color, var(--oc-primary-500)) 8%, var(--oc-surface));
  border-color: color-mix(in srgb, var(--step-color, var(--oc-primary-500)) 30%, var(--oc-border));
}

.oc-exec-step-current {
  background: color-mix(in srgb, var(--step-color, var(--oc-primary-500)) 15%, var(--oc-surface));
  border-color: var(--step-color, var(--oc-primary-500));
  box-shadow:
    0 0 0 2px color-mix(in srgb, var(--step-color, var(--oc-primary-500)) 20%, transparent),
    0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Vertical connector line between steps */
.oc-exec-connector {
  position: absolute;
  top: 100%;
  width: 2px;
  height: 8px;
  background: linear-gradient(
    180deg,
    var(--step-color, var(--oc-primary-500)),
    color-mix(in srgb, var(--step-color, var(--oc-primary-500)) 30%, transparent)
  );
  border-radius: 1px;
  z-index: 1;
}

/* Step number indicator */
.oc-exec-step-num {
  position: absolute;
  left: -32px;
  top: 50%;
  transform: translateY(-50%);
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 9px;
  font-weight: 700;
  color: var(--oc-muted);
  background: var(--oc-surface-2);
  border: 1px solid var(--oc-border);
  border-radius: 50%;
}

.oc-exec-step-current .oc-exec-step-num {
  background: var(--step-color, var(--oc-primary-500));
  color: white;
  border-color: var(--step-color, var(--oc-primary-500));
}

/* Indented content wrapper */
.oc-exec-step-indent {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  flex: 1;
  min-width: 0;
}

/* Node circle with icon */
.oc-exec-step-node {
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  border-radius: 8px;
  color: white;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

/* Step content area */
.oc-exec-step-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* Header line with function context and line number */
.oc-exec-step-header {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}

/* Function context badge */
.oc-exec-step-func {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  font-size: 10px;
  font-weight: 600;
  color: var(--oc-primary-500);
  background: color-mix(in srgb, var(--oc-primary-500) 12%, transparent);
  padding: 2px 8px;
  border-radius: 4px;
}

/* Call/Return badges */
.oc-exec-step-badge {
  display: inline-flex;
  align-items: center;
  gap: 3px;
  font-size: 8px;
  font-weight: 700;
  letter-spacing: 0.06em;
  padding: 2px 6px;
  border-radius: 4px;
}

.oc-exec-step-badge-call {
  background: #06b6d4;
  color: white;
}

.oc-exec-step-badge-return {
  background: #10b981;
  color: white;
}

.oc-exec-step-badge-loop {
  background: color-mix(in srgb, var(--oc-trace-loop) 80%, var(--oc-surface));
  color: var(--oc-on-primary);
  border: 1px solid color-mix(in srgb, var(--oc-trace-loop) 55%, transparent);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.12);
}

.theme-hc .oc-exec-step-badge-loop {
  color: #000;
}

.oc-exec-step-badge-import {
  background: color-mix(in srgb, var(--oc-trace-import) 85%, var(--oc-surface));
  color: var(--oc-on-primary);
  border: 1px solid color-mix(in srgb, var(--oc-trace-import) 55%, transparent);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
}

.oc-exec-step-badge-import-usage {
  background: color-mix(in srgb, var(--oc-trace-import) 25%, transparent);
  color: var(--oc-trace-import);
  border: 1px dashed color-mix(in srgb, var(--oc-trace-import) 55%, transparent);
}

/* Location (file:line) */
.oc-exec-step-loc {
  font-size: 11px;
  color: var(--oc-muted);
  font-family: ui-monospace, monospace;
  margin-left: auto;
}

.oc-exec-step-target {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: 10px;
  font-weight: 600;
  color: var(--oc-muted);
  padding: 2px 6px;
  border-radius: 4px;
  background: color-mix(in srgb, var(--oc-trace-import) 12%, transparent);
  border: 1px solid color-mix(in srgb, var(--oc-trace-import) 25%, transparent);
}

/* Code preview */
.oc-exec-step-code {
  background: var(--oc-surface-2);
  border: 1px solid var(--oc-border);
  border-radius: 6px;
  padding: 6px 10px;
  font-size: 11px;
  line-height: 1.4;
  overflow: hidden;
}

.oc-exec-step-code code {
  font-family: ui-monospace, 'SF Mono', 'Cascadia Code', monospace;
  color: var(--oc-fg);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  display: block;
}

/* Entry/Exit step styling */
.oc-exec-step[data-entry="true"],
.oc-exec-step[data-exit="true"] {
  background: color-mix(in srgb, var(--step-color, #22c55e) 8%, var(--oc-surface));
  border-style: dashed;
}

/* Loop emphasis */
.oc-exec-step[data-loop="true"] {
  border-style: dashed;
  background: color-mix(in srgb, var(--oc-trace-loop) 12%, var(--oc-surface));
  box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--oc-trace-loop) 35%, transparent);
}

.oc-exec-step[data-loop="true"] .oc-exec-step-node {
  box-shadow:
    0 3px 8px rgba(0, 0, 0, 0.25),
    0 0 0 2px color-mix(in srgb, var(--oc-trace-loop) 40%, transparent);
}

.oc-exec-step[data-loop="true"] .oc-exec-step-num {
  background: color-mix(in srgb, var(--oc-trace-loop) 65%, var(--oc-surface));
  color: var(--oc-on-primary);
  border-color: color-mix(in srgb, var(--oc-trace-loop) 55%, transparent);
}

.oc-exec-step[data-loop="true"]::after {
  background: color-mix(in srgb, var(--oc-trace-loop) 45%, transparent);
}

/* Branch step styling */
.oc-exec-step[data-branch="true"] {
  opacity: 0.85;
  border-style: dotted;
}

/* Depth indication via left border */
.oc-exec-step::before {
  content: '';
  position: absolute;
  left: 0;
  top: 8px;
  bottom: 8px;
  width: 3px;
  background: var(--step-color, var(--oc-primary-500));
  border-radius: 2px;
  opacity: 0.6;
}

.oc-exec-step:hover::before {
  opacity: 1;
}

/* Subtle left-side tree lines for depth */
.oc-exec-step::after {
  content: '';
  position: absolute;
  left: -16px;
  top: 50%;
  width: 14px;
  height: 2px;
  background: color-mix(in srgb, var(--step-color, var(--oc-primary-500)) 40%, transparent);
  border-radius: 1px;
}

/* Animation for step entry */
@keyframes oc-exec-step-enter {
  from {
    opacity: 0;
    transform: translateX(-12px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
